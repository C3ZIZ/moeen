{
  "info": {
    "name": "TaskFlow API",
    "_postman_id": "taskflow-collection-0001",
    "description": "Postman collection for TaskFlow API (generated from code).",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Auth",
      "item": [
        {
          "name": "Register User A",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"User A\",\n  \"email\": \"{{userA_email}}\",\n  \"password\": \"{{userA_password}}\",\n  \"password_confirmation\": \"{{userA_password}}\"\n}"
            },
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/auth/register",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","auth","register"],
              "query": []
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Register returns 201', function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "var res = pm.response.json();",
                  "pm.environment.set('userA_id', res.user.id || (res.user && res.user.id));",
                  "// token returned on register but we'll use dedicated Login step to set tokens",
                  "if (res.token) { pm.environment.set('tokenA', res.token); }"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Register User B",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"User B\",\n  \"email\": \"{{userB_email}}\",\n  \"password\": \"{{userB_password}}\",\n  \"password_confirmation\": \"{{userB_password}}\"\n}"
            },
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/auth/register",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","auth","register"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Register B returns 201', function () { pm.response.to.have.status(201); });",
                  "var res = pm.response.json();",
                  "pm.environment.set('userB_id', res.user.id || (res.user && res.user.id));",
                  "if (res.token) { pm.environment.set('tokenB', res.token); }"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Login User A",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{userA_email}}\",\n  \"password\": \"{{userA_password}}\"\n}"
            },
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/auth/login",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","auth","login"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Login A returns 200', function () { pm.response.to.have.status(200); });",
                  "var res = pm.response.json();",
                  "pm.environment.set('tokenA', res.token);",
                  "pm.environment.set('userA_id', res.user.id || (res.user && res.user.id));"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Login User B",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{userB_email}}\",\n  \"password\": \"{{userB_password}}\"\n}"
            },
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/auth/login",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","auth","login"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Login B returns 200', function () { pm.response.to.have.status(200); });",
                  "var res = pm.response.json();",
                  "pm.environment.set('tokenB', res.token);",
                  "pm.environment.set('userB_id', res.user.id || (res.user && res.user.id));"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Me (User A)",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{tokenA}}" }
            ],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/me",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","me"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Me returns 200', function () { pm.response.to.have.status(200); });",
                  "var res = pm.response.json();",
                  "if (res && res.id) { pm.environment.set('userA_id', res.id); }"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Logout (User A)",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{tokenA}}" }
            ],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/auth/logout",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","auth","logout"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Logout returns 200', function () { pm.response.to.have.status(200); });",
                  "pm.environment.unset('tokenA');"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Workspace (User A)",
      "item": [
        {
          "name": "Create Workspace (save workspace_id)",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{tokenA}}" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Test Workspace\"\n}"
            },
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/workspaces",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","workspaces"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Create workspace returns 201', function () { pm.response.to.have.status(201); });",
                  "var res = pm.response.json();",
                  "pm.environment.set('workspace_id', res.data.id);"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "List Workspaces",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{tokenA}}" }
            ],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/workspaces",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","workspaces"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('List workspaces returns 200', function () { pm.response.to.have.status(200); });",
                  "var res = pm.response.json();",
                  "pm.test('Workspaces is array', function () { pm.expect(Array.isArray(res.data)).to.be.true; });"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Get Workspace (expect 200)",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{tokenA}}" }
            ],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/workspaces/{{workspace_id}}",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","workspaces","{{workspace_id}}"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Get workspace returns 200', function () { pm.response.to.have.status(200); });",
                  "var res = pm.response.json();",
                  "pm.test('workspace has id', function () { pm.expect(res.data.id).to.eql(parseInt(pm.environment.get('workspace_id'))); });"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Update Workspace (expect 200)",
          "request": {
            "method": "PATCH",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{tokenA}}" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Test Workspace Updated\"\n}"
            },
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/workspaces/{{workspace_id}}",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","workspaces","{{workspace_id}}"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Update workspace returns 200', function () { pm.response.to.have.status(200); });",
                  "var res = pm.response.json();",
                  "pm.test('workspace name updated', function () { pm.expect(res.data.name).to.eql('Test Workspace Updated'); });"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Workspace Membership + Role Rules",
      "item": [
        {
          "name": "Get Workspace as User B BEFORE add (expect 403)",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{tokenB}}" }
            ],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/workspaces/{{workspace_id}}",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","workspaces","{{workspace_id}}"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('User B cannot access workspace before membership', function () { pm.response.to.have.status(403); });"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Add Member (expect 201)",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{tokenA}}" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{userB_email}}\",\n  \"role\": \"{{role_member}}\"\n}"
            },
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/workspaces/{{workspace_id}}/members",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","workspaces","{{workspace_id}}","members"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Add member returns 201', function () { pm.response.to.have.status(201); });"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Get Workspace as User B AFTER add (expect 200)",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{tokenB}}" }
            ],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/workspaces/{{workspace_id}}",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","workspaces","{{workspace_id}}"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('User B can access workspace after being added', function () { pm.response.to.have.status(200); });",
                  "var res = pm.response.json();",
                  "pm.test('members list contains userB', function () {",
                  "  var found = (res.data.members || []).some(function(m){ return m.id === parseInt(pm.environment.get('userB_id')); });",
                  "  pm.expect(found).to.be.true;",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Update Member Role to admin (expect 200)",
          "request": {
            "method": "PATCH",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{tokenA}}" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"role\": \"{{role_admin}}\"\n}"
            },
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/workspaces/{{workspace_id}}/members/{{userB_id}}",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","workspaces","{{workspace_id}}","members","{{userB_id}}"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Update member role returns 200', function () { pm.response.to.have.status(200); });"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Duplicate Add Member (expect 409)",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{tokenA}}" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{userB_email}}\",\n  \"role\": \"{{role_member}}\"\n}"
            },
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/workspaces/{{workspace_id}}/members",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","workspaces","{{workspace_id}}","members"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Duplicate add returns 409', function () { pm.response.to.have.status(409); });"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Remove Member (expect 200)",
          "request": {
            "method": "DELETE",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{tokenA}}" }
            ],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/workspaces/{{workspace_id}}/members/{{userB_id}}",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","workspaces","{{workspace_id}}","members","{{userB_id}}"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Remove member returns 200', function () { pm.response.to.have.status(200); });"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Get Workspace as User B AFTER removal (expect 403)",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{tokenB}}" }
            ],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/workspaces/{{workspace_id}}",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","workspaces","{{workspace_id}}"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('User B cannot access workspace after removal', function () { pm.response.to.have.status(403); });"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Projects (User A)",
      "item": [
        {
          "name": "Create Project under Workspace (save project_id)",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{tokenA}}" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Test Project\"\n}"
            },
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/workspaces/{{workspace_id}}/projects",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","workspaces","{{workspace_id}}","projects"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Create project returns 201', function () { pm.response.to.have.status(201); });",
                  "var res = pm.response.json();",
                  "pm.environment.set('project_id', res.data.id);"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "List Projects under Workspace",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{tokenA}}" }
            ],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/workspaces/{{workspace_id}}/projects",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","workspaces","{{workspace_id}}","projects"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('List projects returns 200', function () { pm.response.to.have.status(200); });",
                  "var res = pm.response.json();",
                  "pm.test('projects is array', function () { pm.expect(Array.isArray(res.data)).to.be.true; });"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Get Project",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{tokenA}}" }
            ],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/projects/{{project_id}}",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","projects","{{project_id}}"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Get project returns 200', function () { pm.response.to.have.status(200); });",
                  "var res = pm.response.json();",
                  "pm.test('project id matches', function () { pm.expect(res.data.id).to.eql(parseInt(pm.environment.get('project_id'))); });"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Update Project",
          "request": {
            "method": "PATCH",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{tokenA}}" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Test Project Updated\"\n}"
            },
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/projects/{{project_id}}",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","projects","{{project_id}}"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Update project returns 200', function () { pm.response.to.have.status(200); });",
                  "var res = pm.response.json();",
                  "pm.test('project name updated', function () { pm.expect(res.data.name).to.eql('Test Project Updated'); });"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Tasks",
      "item": [
        {
          "name": "Create Task under Project (save task_id)",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{tokenA}}" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"title\": \"Test Task\",\n  \"description\": \"Task created by Postman\",\n  \"status\": \"todo\",\n  \"priority\": \"high\"\n}"
            },
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/projects/{{project_id}}/tasks",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","projects","{{project_id}}","tasks"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Create task returns 201', function () { pm.response.to.have.status(201); });",
                  "var res = pm.response.json();",
                  "pm.environment.set('task_id', res.data.id);"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "List Tasks with filters (status/priority/q)",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{tokenA}}" }
            ],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/projects/{{project_id}}/tasks?status=todo&priority=high&q=Test&page=1",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","projects","{{project_id}}","tasks"],
              "query": [
                { "key": "status", "value": "todo" },
                { "key": "priority", "value": "high" },
                { "key": "q", "value": "Test" },
                { "key": "page", "value": "1" }
              ]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('List tasks returns 200', function () { pm.response.to.have.status(200); });",
                  "var res = pm.response.json();",
                  "pm.test('tasks data exists', function () { pm.expect(res.data).to.exist; });"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Get Task (includes comments + reminders)",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{tokenA}}" }
            ],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/tasks/{{task_id}}",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","tasks","{{task_id}}"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Get task returns 200', function () { pm.response.to.have.status(200); });",
                  "var res = pm.response.json();",
                  "pm.test('task data has comments and reminders arrays', function () {",
                  "  pm.expect(res.data).to.have.property('comments');",
                  "  pm.expect(res.data).to.have.property('reminders');",
                  "  pm.expect(Array.isArray(res.data.comments)).to.be.true;",
                  "  pm.expect(Array.isArray(res.data.reminders)).to.be.true;",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Update Task (status, priority, due_at)",
          "request": {
            "method": "PATCH",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{tokenA}}" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"status\": \"doing\",\n  \"priority\": \"medium\",\n  \"due_at\": \"2026-12-31T12:00:00Z\"\n}"
            },
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/tasks/{{task_id}}",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","tasks","{{task_id}}"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Update task returns 200', function () { pm.response.to.have.status(200); });",
                  "var res = pm.response.json();",
                  "pm.test('task status changed', function(){ pm.expect(res.data.status).to.eql('doing'); });",
                  "pm.test('task priority changed', function(){ pm.expect(res.data.priority).to.eql('medium'); });"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Comments",
      "item": [
        {
          "name": "Add Comment (save comment_id if returned)",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{tokenA}}" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"content\": \"This is a test comment.\",\n  \"body\": \"This is a test comment.\" \n}"
            },
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/tasks/{{task_id}}/comments",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","tasks","{{task_id}}","comments"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Add comment returns 201', function () { pm.response.to.have.status(201); });",
                  "var res = pm.response.json();",
                  "if (res.data && res.data.id) pm.environment.set('comment_id', res.data.id);"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Get Task again and assert comment exists",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{tokenA}}" }
            ],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/tasks/{{task_id}}",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","tasks","{{task_id}}"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Get task returns 200', function () { pm.response.to.have.status(200); });",
                  "var res = pm.response.json();",
                  "var cid = pm.environment.get('comment_id');",
                  "if (cid) {",
                  "  var found = (res.data.comments || []).some(function(c){ return c.id === parseInt(cid); });",
                  "  pm.test('Comment exists on task', function () { pm.expect(found).to.be.true; });",
                  "} else { pm.test('No comment_id saved', function(){ pm.expect(true).to.be.true; }); }"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Reminders + Queue Test",
      "item": [
        {
          "name": "Create Reminder for near-future (save reminder_id)",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{tokenA}}" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"runs_at\": \"{{now_plus_1_minute}}\"\n}"
            },
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/tasks/{{task_id}}/reminders",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","tasks","{{task_id}}","reminders"]
            }
          },
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "// Compute now_plus_1_minute if not set; set ISO string acceptable by Laravel",
                  "if(!pm.environment.get('now_plus_1_minute')){",
                  "  var now = new Date();",
                  "  now.setMinutes(now.getMinutes()+1);",
                  "  pm.environment.set('now_plus_1_minute', now.toISOString());",
                  "}"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Create reminder returns 201', function () { pm.response.to.have.status(201); });",
                  "var res = pm.response.json();",
                  "if (res.data && res.data.id) pm.environment.set('reminder_id', res.data.id);"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Manual: Wait and Check Reminder sent_at (run after queue + schedule)",
          "request": {
            "method": "GET",
            "header": [
              { "key": "Content-Type", "value": "application/json" },
              { "key": "Authorization", "value": "Bearer {{tokenA}}" }
            ],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/tasks/{{task_id}}",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","tasks","{{task_id}}"]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Get task returns 200', function () { pm.response.to.have.status(200); });",
                  "var res = pm.response.json();",
                  "var rid = pm.environment.get('reminder_id');",
                  "if (rid) {",
                  "  var r = (res.data.reminders || []).find(function(x){ return x.id === parseInt(rid); });",
                  "  pm.test('Reminder exists on task', function() { pm.expect(r).to.exist; });",
                  "  if (r) { pm.test('Reminder sent_at may be set after queue run', function(){ /* manual check */ pm.expect(true).to.be.true; }); }",
                  "} else { pm.test('No reminder_id saved', function(){ pm.expect(true).to.be.true; }); }"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ]
    }
  ],
  "event": [],
  "variable": [
    { "key": "base_url", "value": "http://127.0.0.1:8000" },
    { "key": "api_prefix", "value": "/api" }
  ]
}