{
  "info": {
    "name": "Moeen API",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "version": {
      "major": 1,
      "minor": 0,
      "patch": 0
    }
  },
  "item": [
    {
      "name": "Auth",
      "item": [
        {
          "name": "Register User A",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/auth/register",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","auth","register"],
              "variable": []
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"User A\",\n  \"email\": \"{{userA_email}}\",\n  \"password\": \"{{userA_password}}\",\n  \"password_confirmation\": \"{{userA_password}}\"\n}"
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"status is 201\", function () {",
                  "  pm.response.to.have.status(201);",
                  "});",
                  "var json = pm.response.json();",
                  "if (json.token) {",
                  "  pm.environment.set('tokenA', json.token);",
                  "}",
                  "if (json.user && json.user.id) {",
                  "  pm.environment.set('userA_id', json.user.id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Register User B",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/auth/register",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","auth","register"]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"User B\",\n  \"email\": \"{{userB_email}}\",\n  \"password\": \"{{userB_password}}\",\n  \"password_confirmation\": \"{{userB_password}}\"\n}"
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"status is 201\", function () {",
                  "  pm.response.to.have.status(201);",
                  "});",
                  "var json = pm.response.json();",
                  "if (json.token) {",
                  "  pm.environment.set('tokenB', json.token);",
                  "}",
                  "if (json.user && json.user.id) {",
                  "  pm.environment.set('userB_id', json.user.id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Login User A",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/auth/login",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","auth","login"]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{userA_email}}\",\n  \"password\": \"{{userA_password}}\"\n}"
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"status is 200\", function () {",
                  "  pm.response.to.have.status(200);",
                  "});",
                  "var json = pm.response.json();",
                  "if (json.token) {",
                  "  pm.environment.set('tokenA', json.token);",
                  "}",
                  "if (json.user && json.user.id) {",
                  "  pm.environment.set('userA_id', json.user.id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Login User B",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/auth/login",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","auth","login"]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{userB_email}}\",\n  \"password\": \"{{userB_password}}\"\n}"
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"status is 200\", function () {",
                  "  pm.response.to.have.status(200);",
                  "});",
                  "var json = pm.response.json();",
                  "if (json.token) {",
                  "  pm.environment.set('tokenB', json.token);",
                  "}",
                  "if (json.user && json.user.id) {",
                  "  pm.environment.set('userB_id', json.user.id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Me (User A)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{tokenA}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/me",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","me"]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"status is 200\", function () {",
                  "  pm.response.to.have.status(200);",
                  "});",
                  "var json = pm.response.json();",
                  "pm.test('response has id', function(){",
                  "  pm.expect(json).to.have.property('id');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Logout (User A)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{tokenA}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/auth/logout",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","auth","logout"]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"status 200 or 204\", function () {",
                  "  pm.response.to.be.ok;",
                  "});",
                  "pm.environment.unset('tokenA');"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Workspace (User A)",
      "item": [
        {
          "name": "Create Workspace",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{tokenA}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/workspaces",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","workspaces"]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Test Workspace\"\n}"
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"status is 201\", function () {",
                  "  pm.response.to.have.status(201);",
                  "});",
                  "var json = pm.response.json();",
                  "if (json.data && json.data.id) {",
                  "  pm.environment.set('workspace_id', json.data.id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "List Workspaces",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{tokenA}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/workspaces",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","workspaces"]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"status is 200\", function () {",
                  "  pm.response.to.have.status(200);",
                  "});",
                  "var json = pm.response.json();",
                  "pm.test('data is array', function(){",
                  "  pm.expect(json.data).to.be.an('array');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Get Workspace",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{tokenA}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/workspaces/{{workspace_id}}",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","workspaces","{{workspace_id}}"]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"status is 200\", function () {",
                  "  pm.response.to.have.status(200);",
                  "});",
                  "var json = pm.response.json();",
                  "pm.test('has owner and members', function(){",
                  "  pm.expect(json.data).to.have.property('owner');",
                  "  pm.expect(json.data).to.have.property('members');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Update Workspace",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{tokenA}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/workspaces/{{workspace_id}}",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","workspaces","{{workspace_id}}"]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Test Workspace Updated\"\n}"
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"status is 200\", function () {",
                  "  pm.response.to.have.status(200);",
                  "});",
                  "var json = pm.response.json();",
                  "pm.test('name updated', function(){",
                  "  pm.expect(json.data.name).to.eql('Test Workspace Updated');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Workspace Membership + Role Rules",
      "item": [
        {
          "name": "Get Workspace as User B BEFORE add (expect 403)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{tokenB}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/workspaces/{{workspace_id}}",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","workspaces","{{workspace_id}}"]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"status is 403\", function () {",
                  "  pm.response.to.have.status(403);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Add Member (userB_email, role=member)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{tokenA}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/workspaces/{{workspace_id}}/members",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","workspaces","{{workspace_id}}","members"]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{userB_email}}\",\n  \"role\": \"{{role_member}}\"\n}"
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"status 201 or 200\", function () {",
                  "  pm.expect(pm.response.code === 201 || pm.response.code === 200).to.be.true;",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Get Workspace as User B AFTER add (expect 200)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{tokenB}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/workspaces/{{workspace_id}}",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","workspaces","{{workspace_id}}"]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"status is 200\", function () {",
                  "  pm.response.to.have.status(200);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Update Member Role to admin",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{tokenA}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/workspaces/{{workspace_id}}/members/{{userB_id}}",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","workspaces","{{workspace_id}}","members","{{userB_id}}"]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"role\": \"{{role_admin}}\"\n}"
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"status 200\", function () {",
                  "  pm.response.to.have.status(200);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Duplicate Add Member (expect 409)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{tokenA}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/workspaces/{{workspace_id}}/members",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","workspaces","{{workspace_id}}","members"]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"{{userB_email}}\",\n  \"role\": \"{{role_member}}\"\n}"
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"status is 409\", function () {",
                  "  pm.response.to.have.status(409);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Remove Member",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{tokenA}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/workspaces/{{workspace_id}}/members/{{userB_id}}",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","workspaces","{{workspace_id}}","members","{{userB_id}}"]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"status is 200\", function () {",
                  "  pm.response.to.have.status(200);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Get Workspace as User B AFTER removal (expect 403)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{tokenB}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/workspaces/{{workspace_id}}",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","workspaces","{{workspace_id}}"]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"status is 403\", function () {",
                  "  pm.response.to.have.status(403);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Projects (User A)",
      "item": [
        {
          "name": "Create Project under Workspace",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{tokenA}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/workspaces/{{workspace_id}}/projects",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","workspaces","{{workspace_id}}","projects"]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Test Project\"\n}"
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"status is 201\", function () {",
                  "  pm.response.to.have.status(201);",
                  "});",
                  "var json = pm.response.json();",
                  "if (json.data && json.data.id) {",
                  "  pm.environment.set('project_id', json.data.id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "List Projects under Workspace",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{tokenA}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/workspaces/{{workspace_id}}/projects",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","workspaces","{{workspace_id}}","projects"]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"status is 200\", function () {",
                  "  pm.response.to.have.status(200);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Get Project",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{tokenA}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/projects/{{project_id}}",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","projects","{{project_id}}"]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"status is 200\", function () {",
                  "  pm.response.to.have.status(200);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Update Project",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{tokenA}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/projects/{{project_id}}",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","projects","{{project_id}}"]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Updated Project Name\"\n}"
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"status is 200\", function () {",
                  "  pm.response.to.have.status(200);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Tasks",
      "item": [
        {
          "name": "Create Task under Project",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{tokenA}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/projects/{{project_id}}/tasks",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","projects","{{project_id}}","tasks"]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"title\": \"Test Task 1\",\n  \"description\": \"A task for testing\",\n  \"status\": \"todo\",\n  \"priority\": \"medium\",\n  \"due_at\": \"2026-01-10T12:00:00Z\"\n}"
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"status is 201\", function () {",
                  "  pm.response.to.have.status(201);",
                  "});",
                  "var json = pm.response.json();",
                  "if (json.data && json.data.id) {",
                  "  pm.environment.set('task_id', json.data.id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "List Tasks with filters (status/priority/q)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{tokenA}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/projects/{{project_id}}/tasks?status=todo&priority=medium&q=Test",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","projects","{{project_id}}","tasks"],
              "query": [
                { "key": "status", "value": "todo" },
                { "key": "priority", "value": "medium" },
                { "key": "q", "value": "Test" }
              ]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"status is 200\", function () {",
                  "  pm.response.to.have.status(200);",
                  "});",
                  "var json = pm.response.json();",
                  "pm.test('has data array or docs', function(){",
                  "  pm.expect(json.data || json.data === undefined).to.exist;",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Get Task (should include comments + reminders)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{tokenA}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/tasks/{{task_id}}",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","tasks","{{task_id}}"]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"status is 200\", function () {",
                  "  pm.response.to.have.status(200);",
                  "});",
                  "var json = pm.response.json();",
                  "pm.test('data has comments and reminders arrays', function(){",
                  "  pm.expect(json.data).to.have.property('comments');",
                  "  pm.expect(json.data).to.have.property('reminders');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Update Task (status, priority, due_at)",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{tokenA}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/tasks/{{task_id}}",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","tasks","{{task_id}}"]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"status\": \"doing\",\n  \"priority\": \"high\",\n  \"due_at\": \"2026-01-11T12:00:00Z\"\n}"
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"status is 200\", function () {",
                  "  pm.response.to.have.status(200);",
                  "});",
                  "var json = pm.response.json();",
                  "pm.test('status updated', function(){",
                  "  pm.expect(json.data.status).to.eql('doing');",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Comments",
      "item": [
        {
          "name": "Add Comment (NOTE: controller/validator mismatch — see walkthrough)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{tokenA}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/tasks/{{task_id}}/comments",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","tasks","{{task_id}}","comments"]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"content\": \"Nice job on this task\"\n}"
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// The project currently has a mismatch: Request expects 'content' but controller uses 'body'.",
                  "// If the endpoint is patched to use 'content' this test will expect 201.",
                  "if (pm.response.code === 201) {",
                  "  var json = pm.response.json();",
                  "  if (json.data && json.data.id) { pm.environment.set('comment_id', json.data.id); }",
                  "  pm.test('comment created', function(){ pm.expect(pm.response.code).to.eql(201); });",
                  "} else {",
                  "  // record the failure to help debugging",
                  "  pm.test('expected 201 — got ' + pm.response.code, function(){",
                  "    pm.expect(pm.response.code).to.oneOf([201]);",
                  "  });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Get Task and assert comment exists (if created)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{tokenA}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/tasks/{{task_id}}",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","tasks","{{task_id}}"]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"status is 200\", function () { pm.response.to.have.status(200); });",
                  "var json = pm.response.json();",
                  "if (pm.environment.get('comment_id')) {",
                  "  var found = (json.data.comments || []).some(function(c){ return c.id == pm.environment.get('comment_id'); });",
                  "  pm.test('comment present in task', function(){ pm.expect(found).to.be.true; });",
                  "} else {",
                  "  pm.test('no comment_id saved — skip presence assert', function(){ pm.expect(true).to.be.true; });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ]
        }
      ]
    },
    {
      "name": "Reminders + Queue Test",
      "item": [
        {
          "name": "Create Reminder (runs_at = now + 1 minute)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{tokenA}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/tasks/{{task_id}}/reminders",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","tasks","{{task_id}}","reminders"]
            },
            "body": {
              "mode": "raw",
              "raw": "{\n  \"runs_at\": \"{{now_plus_1_minute}}\"\n}"
            }
          },
          "response": [],
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "// compute now_plus_1_minute if not set or if empty",
                  "if (!pm.environment.get('now_plus_1_minute')) {",
                  "  var dt = new Date(Date.now() + 60000);",
                  "  pm.environment.set('now_plus_1_minute', dt.toISOString());",
                  "}"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"status is 201\", function () {",
                  "  pm.response.to.have.status(201);",
                  "});",
                  "var json = pm.response.json();",
                  "if (json.data && json.data.id) {",
                  "  pm.environment.set('reminder_id', json.data.id);",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Manual: Wait 70s, then Get Task to check reminder.sent_at",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{tokenA}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}{{api_prefix}}/tasks/{{task_id}}",
              "host": ["{{base_url}}"],
              "path": ["{{api_prefix}}","tasks","{{task_id}}"]
            }
          },
          "response": [],
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test(\"status is 200\", function () { pm.response.to.have.status(200); });",
                  "var json = pm.response.json();",
                  "if (pm.environment.get('reminder_id')) {",
                  "  var found = (json.data.reminders || []).some(function(r){ return r.id == pm.environment.get('reminder_id') && r.sent_at; });",
                  "  pm.test('reminder sent_at populated', function(){ pm.expect(found).to.be.true; });",
                  "} else {",
                  "  pm.test('no reminder_id saved — skip sent_at assert', function(){ pm.expect(true).to.be.true; });",
                  "}"
                ],
                "type": "text/javascript"
              }
            }
          ]
        },
        {
          "name": "Notes: start queue worker + scheduler (manual)",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/",
              "host": ["{{base_url}}"]
            },
            "description": "Manual note: Start queue worker and scheduler as noted in the TEST_WALKTHROUGH."
          },
          "response": []
        }
      ]
    }
  ]
}